function skuContent(t,e,a){var r,s=9;i=e.data.skuMap;for(attribute in i)s+=parseInt(i[attribute].quantity);var n="<section class='mask-box'></section><section class='skuBox anmite-show' id='skuSelect'><div class='commodity'><span class='fn-left commodity-img'><img data-src='http://gd3.alicdn.com/bao/uploaded/i3/TB1vqAkLXXXXXXAXXXXXXXXXXXX_!!0-item_pic.jpg_600x600.jpg' id='img' /></span><div class='commodity-tit-price'><h3 class='commodity-tit'>国行联保Canon/佳能微单相机EOS M2 18-55STM镜头eosm2单电数码</h3><em class='commodity-price'><span class='text-color'>¥<i id='price'>151</i></span></em><span class='add-cart'>加入购物车</span><span class='number-control brcolor'><span class='iconfont btn-increase'>&#xe60a;</span><span class='fn-right curnum' id='quantity' data-max='4149'>1</span><span class='iconfont btn-decrease'>&#xe603;</span></span></div></div><div class='sku-control'><dl id='sku-control'>"+t+"</dl></div><div class='buy-number'><span class='number-control number-control-nocart'><span class='fn-right iconfont btn-increase'>&#xe60a;</span><span class='fn-right num-nocart' max='50'>1</span><span class='fn-right iconfont btn-decrease'>&#xe603;</span></span><em>购买数量</em></div><div class='sku-btn-box' style='display:none;'><button class='btn-sku btn-sku-active'>结 算</button><span class='iconfont icon-cart icon-cart-active' id='cartShopping'>&#xe621;<i class='cart-num'>0</i></span><em class='sku-total sku-total-active'>¥<i class='totalPrice'>0</i></em></div><button class='btn-next' id='skuNext'>下一步</button><input type='hidden' id='skuId'><input type='hidden' id='skuInfo'><input type='hidden' id='buyType' value='"+a+"'></section>";_ppathIdmap=e.data.ppathIdmap;var i=e.data.skuMap,c=JSON.stringify(_ppathIdmap);if(c=c.substring(1,c.length-1).replace(/\"/g,""),$("body").append(n),$("body").children().eq(0).addClass("page-box"),goodsIDCookie==goodsID&&skuCookie)for(var o=0,l=skuCookie.length;l>o;o++)for(attribute in _ppathIdmap){var d=_ppathIdmap[attribute];if(skuCookie[o].productSkuId==d){for(var u=attribute.split(";"),p=0,k=u.length;k>p;p++);var y="group"==$("#buyType").val()?i[d].groupPrice:i[d].price;skuCookie[o].price=y,skuSelectedArray.push(skuCookie[o]),r=attribute;break}}document.getElementById("img").addEventListener("tap",function(){var t=$(this),e=t.attr("src"),a=document.getElementById("de-pic-box");if(a)a.getElementsByTagName("img")[0].setAttribute("src",e),a.setAttribute("style","display:block");else{var r=document.createElement("div"),s=document.createElement("img");s.setAttribute("src",e),r.setAttribute("id","de-pic-box"),r.setAttribute("style","display:block"),r.appendChild(s),document.body.appendChild(r),r.addEventListener("tap",function(){this.style.display="none"},!1)}},!1),$(".add-cart").get(0).addEventListener("tap",joinCart,!1),document.getElementById("cartShopping").addEventListener("tap",clickCart,!1),$(".btn-increase").each(function(){this.addEventListener("tap",skuPlus,!1)}),$(".btn-decrease").each(function(){this.addEventListener("tap",skuMinus,!1)}),initSKU(skuArray(c,i));var v=$(".sku-control label");if(v.length>0){r=r?r.split(";"):e.data.floorPrice.split(";");for(var o=0;o<v.length;o++){v[o].addEventListener("click",clickSKU,!1);for(var m=$(v[o]).parent().prev("dt").attr("data-value")+":"+$(v[o]).attr("data-value"),p=0;p<r.length;p++)if(r[p]==m){v[o].click();break}v[o].removeEventListener("click",clickSKU,!1),v[o].addEventListener("tap",clickSKU,!1)}}if(0!=skuSelectedArray.length){for(var h=0,b=0,l=skuSelectedArray.length,o=0;l>o;o++){var f=parseInt(skuSelectedArray[o].count),y=parseFloat(skuSelectedArray[o].price);h+=f,b+=parseFloat(y*f)}$(".cart-num").text(h),$(".totalPrice").text(b.toFixed(2));for(var g=$("#skuId").val(),o=0;l>o;o++)if(skuSelectedArray[o].productSkuId==g){$("#quantity").text(skuSelectedArray[o].count),$(".add-cart").css("display","none").next().css("display","block");break}$(".buy-number").css("display","none").next().css("display","block").next().css("display","none")}$(".mask-box").get(0).addEventListener("tap",maskHideFun,!1)}function skuSelect(t){var e=t.hasClass("btn-buy01")?"single":"group",a=t.find("em").text();a=a.substr(1,a.length),0==$(".skuBox").length?$.ajax({type:"GET",url:"json/sku.json",dataType:"json",success:function(t){for(var r="",s=t.data.skuProps,n=JSON.stringify(t.data.ppathIdmap),i=t.data.floorPrice.split(";"),c=0;c<s.length;c++){for(var o=s[c].values,l="",d="<dt data-item="+c+" data-value="+s[c].propId+">"+s[c].propName+"</dt>",u=0;u<o.length;u++){for(var p=!1,k=s[c].propId+":"+o[u].valueId,y=0;y<i.length;y++)i[y]==k&&(p=!0);n.indexOf(k)>0&&(l+=o[u].imgUrl?"<label data-img="+o[u].imgUrl+" data-value="+o[u].valueId+">"+o[u].name+"</label>":"<label data-value="+o[u].valueId+">"+o[u].name+"</label>")}r+=d+"<dd>"+l+"</dd>"}skuContent(r,t,e,a)},error:function(){alert("Ajax error!")}}):($(".mask-box").css("display","block"),$(".skuBox").removeClass("anmite-hide"))}function skuArray(t,e){var a={};arry=t.split(",");for(var r=0;r<arry.length;r++){arry[r]=arry[r].replace(/\;/g,",");var s=arry[r].lastIndexOf(":")+1;arry[r]=replacePos(arry[r],s,","),arry[r]=arry[r].split(",");for(var n=0;n<arry[r].length;n++){var i=arry[r][n].indexOf(":")+1;arry[r][n]=arry[r][n].substring(i,arry[r][n].length)}var c=arry[r][arry[r].length-1];arry[r]=arry[r].splice(0,arry[r].length-1).join(";"),a[arry[r]]=e[c]}return a}function replacePos(t,e,a){var r=t.substr(0,e-1)+a+t.substring(e,t.length);return r}function clickSKU(){var t,e=$(this),a="",r="";if(oddImgURL=$("#img").attr("data-src"),buyType=$("#buyType").val(),oddprice=$("#price").text(),!$(this).hasClass("disabled")){var s=e.attr("data-img");null!=s?e.hasClass("checked")?$("#img").attr("src",oddImgURL):$("#img").attr("src",s):!1,e.toggleClass("checked").siblings().removeClass("checked");var n=$(".checked");if(n.length){var i=[];n.each(function(){i.push($(this).attr("data-value"))}),i.sort(function(t,e){return parseInt(t)-parseInt(e)});var c=i.length,o="single"==buyType?SKUResult[i.join(";")].prices:SKUResult[i.join(";")].groupPrices,l=Math.max.apply(Math,o),d=Math.min.apply(Math,o);$("#price").text(l>d?d+"-"+l:l),$(".sku-control label").not(n).not(e).each(function(){var t=$(this).siblings(".checked"),e=[];if(t.length)for(var a=t.attr("data-value"),r=0;c>r;r++)i[r]!=a&&e.push(i[r]);else e=i.concat();e=e.concat($(this).attr("data-value")),e.sort(function(t,e){return parseInt(t)-parseInt(e)}),SKUResult[e.join(";")]?$(this).removeClass("disabled"):$(this).addClass("disabled")})}else $("#price").text(oddprice),$(".sku-control label").each(function(){SKUResult[$(this).attr("data-value")]?$(this).removeClass("disabled"):$(this).addClass("disabled")})}$(".checked").each(function(){a+=$(this).parent("dd").prev().attr("data-value")+":"+$(this).attr("data-value")+";";var t=$(this).parent().prev().text(),e=$(this).text();r+=t+":"+e+"  "}),a=a.substring(0,a.length-1),t=_ppathIdmap[a],$("#skuId").val(t),$("#skuInfo").val(r);for(var o=0,u=skuSelectedArray.length;u>o;o++){var p=skuSelectedArray[o].productSkuId;if(t==p){var k=skuSelectedArray[o].count;$("#quantity").text(k),$(".add-cart").css("display","none"),$(".brcolor").css("display","block");break}$(".brcolor").css("display","none"),$(".add-cart").css("display","block")}}function getObjKeys(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[e.length]=a);return e}function add2SKUResult(t,e){var a=t.join(";");SKUResult[a]?(SKUResult[a].quantity+=e.quantity,SKUResult[a].prices.push(e.price),SKUResult[a].groupPrices.push(e.groupPrice)):SKUResult[a]={quantity:e.quantity,prices:[e.price],groupPrices:[e.groupPrice]}}function initSKU(t){var e,a,r=getObjKeys(t);for(e=0;e<r.length;e++){var s=r[e],n=t[s],i=s.split(";");i.sort(function(t,e){return parseInt(t)-parseInt(e)});var c=arrayCombine(i);for(a=0;a<c.length;a++)add2SKUResult(c[a],n);SKUResult[i.join(";")]={quantity:n.quantity,prices:[n.price],groupPrices:[n.groupPrice]}}}function arrayCombine(t){if(!t||!t.length)return[];for(var e=t.length,a=[],r=1;e>r;r++)for(var s=getFlagArrs(e,r);s.length;){for(var n=s.shift(),i=[],c=0;e>c;c++)n[c]&&i.push(t[c]);a.push(i)}return a}function getFlagArrs(t,e){if(!e||1>e)return[];var a,r,s,n=[],i=[],c=!1;for(a=0;t>a;a++)i[a]=e>a?1:0;for(n.push(i.concat());!c;)for(s=0,a=0;t-1>a;a++){if(1==i[a]&&0==i[a+1]){for(r=0;a>r;r++)i[r]=s>r?1:0;i[a]=0,i[a+1]=1;var o=i.concat();n.push(o),-1==o.slice(-e).join("").indexOf("0")&&(c=!0);break}1==i[a]&&s++}return n}function judgment(){var t=!0;if(len=$(".checked").length,len!=$(".sku-control dt").length)for(var e=0;e<$(".sku-control dt").length;e++){var a=$(".sku-control dt").get(e),r=$(a).text();if(0==$(a).next("dd").find(".checked").length){toastTips("您尚未选择"+r),t=!1;break}}return t}function skuSelected(){var t={},e=$("#skuId").val(),a="",r=$("#quantity").text(),s=[],n=$("#price").text(),i=$("#sku-control dt");return i.each(function(){var t=$(this).next().find(".checked");s.push($(this).text()+":"+t.text());var e=t.attr("data-img");null!=e&&(a=e)}),t.productSkuId=e,t.imgUrl=a,t.count=parseInt(r),t.price=n,t.propertyInfo=s.join(";"),skuSelectedArray.push(t),skuSelectedArray}function joinCart(){var t=$(this);if(judgment()){if("none"!=$(".buy-number").css("display")){var e=$(".num-nocart").text();$("#quantity").html(e)}else $("#quantity").html("1");$(".buy-number").css("display","none").next().css("display","block").next().css("display","none"),t.css("display","none").next().css("display","block");var a=parseFloat($("#price").text()),r=$(".icon-cart");if(r.addClass("icon-cart-active"),r.prev().addClass("btn-sku-active"),0==$(".cart-num").text()){var s=$("#quantity").text();$(".cart-num").text(s),r.next().find(".totalPrice").text(parseFloat(a*s).toFixed(2))}else{var n=parseInt($(".cart-num").text())+1,i=parseFloat($(".totalPrice").text());i=parseFloat(i+a).toFixed(2),$(".totalPrice").text(i),$(".cart-num").text(n)}skuSelected()}}function skuPlus(){var t=$(this),e=parseInt(t.next().text()),a=t.parent().hasClass("brcolor");if(a||"block"!=$(".buy-number").css("display")){var r=skuArrayIndex(t),s=parseInt(skuSelectedArray[r].count),n=parseFloat(skuSelectedArray[r].price),i=$("<span class='animate-point' />");t.parent().append(i),skuSelectedArray[r].count=s+1,setTimeout(function(){var t=parseInt($(".cart-num").text())+1,e=parseFloat($(".totalPrice").text());e=parseFloat(e+n).toFixed(2),$(".cart-num").text(t),$(".animate-point").eq(0).remove(),$(".totalPrice").text(e)},1e3)}$(this).next().text(e+1),console.log("1111")}function skuMinus(){var t=$(this);if(void 0==skuArrayIndex(t)){var e=parseInt($(".num-nocart").text());return 1!=e&&$(".num-nocart").text(e-1),!1}var a=skuArrayIndex(t),r=parseInt(skuSelectedArray[a].count),s=parseFloat(skuSelectedArray[a].price),n=parseInt($(".cart-num").text())-1,i=parseFloat($(".totalPrice").text());i=parseFloat(i-s).toFixed(2),0==n?($("#shoppingCart").length&&maskHideFun(),$(".cart-num").text("0"),$(".buy-number").css("display","block").next().css("display","none").next().css("display","block"),$(".num-nocart").text("1"),$(".commodity .number-control").css("display","none"),$(".add-cart").css("display","block"),skuSelectedArray.splice(a,1)):r>1?($(this).prev(".curnum").text(r-1),$(".cart-num").text(n),$(".totalPrice").text(i),t.prev().text(r-1),skuSelectedArray[a].count=r-1):($(".cart-num").text(n),$(".totalPrice").text(i),$("#shoppingCart").length?$(this).parents(".sku-item").remove():($(".commodity .number-control").css("display","none"),$(".add-cart").css("display","block")),skuSelectedArray.splice(a,1))}function skuArrayIndex(t){for(var e=t?t.parent().next("input").val():!1,a=e?e:$("#skuId").val(),r=0,s=skuSelectedArray.length;s>r;r++){var n=skuSelectedArray[r].productSkuId;if(n===a)return r}}function clickCart(){var t=$(this),e="",a=0,r=0;if(t.hasClass("icon-cart-active")){for(var s=0,n=skuSelectedArray.length;n>s;s++){for(var i="",c=parseInt(skuSelectedArray[s].count),o=parseFloat(skuSelectedArray[s].price),l=skuSelectedArray[s].productSkuId,d=skuSelectedArray[s].propertyInfo,u=d.split(";"),p=0,k=u.length;k>p;p++)for(var y=u[p].split(":"),v=0,m=y.length;m>v;v++)if(1==v){i+="<span class='sku-info'><em>#</em>"+y[v]+"</span>";break}e+="<div class='sku-item'><div class='sku-item-box'>"+i+"</div><span class='number-control number-control1'><span class='iconfont btn-increase'>&#xe60a;</span><span class='fn-right curnum'>"+c+"</span><span class='iconfont btn-decrease'>&#xe603;</span></span><input type='hidden' value="+l+" /></div>",r+=parseFloat(c*o),a+=c}var h="<section class='skuBox skuBox-cart anmite-show' id='shoppingCart'>"+e+"<div class='icon-cart-box'><span class='iconfont icon-cart icon-cart-active'>&#xe621;<i class='cart-num'>"+a+"</i></span></div><div class='sku-btn-box'><button class='btn-sku btn-sku-active'>结 算</button><em class='sku-total sku-total-active' style='margin-left:1.5rem;'>¥<i class='totalPrice'>"+r.toFixed(2)+"</i></em></div></section>";$("#skuSelect").addClass("anmite-hide"),$("body").append(h);var b=document.getElementById("shoppingCart"),f=$(b).find(".btn-decrease"),g=$(b).find(".btn-increase");f.each(function(){this.addEventListener("tap",skuMinus,!1)}),g.each(function(){this.addEventListener("tap",skuPlus,!1)})}}function maskHideFun(){if(0!=$(".skuBox-cart").length){var t=skuArrayIndex();if($(".skuBox-cart").remove(),void 0==t)$(".commodity .number-control").css("display","none"),$(".add-cart").css("display","block");else{var e=skuSelectedArray[t].count;$("#quantity").text(e)}$("#skuSelect").removeClass("anmite-hide")}else $(".mask-box").css("display","none"),$("#skuSelect").addClass("anmite-hide"),$("body").children().eq(0).removeClass("page-box")}var SKUResult={},_ppathIdmap,skuSelectedArray=[],goodsID=15415664,goodsIDCookie=15415664,skuCookie=[{count:7,imgUrl:"http://gd3.alicdn.com/bao/uploaded/i3/2628086722/TB2X_GgmFXXXXbBXpXXXXXXXXXX_!!2628086722.jpg",price:"18",productSkuId:"3147270890549",propertyInfo:"颜色分类:黑色;拖把头个数:3个;类型:金属篮;拖把杆类型:加强杆+不锈钢盘"},{count:5,imgUrl:"http://gd4.alicdn.com/bao/uploaded/i4/2628086722/TB2fn0vgFXXXXawXXXXXXXXXXXX_!!2628086722.jpg",price:"200",productSkuId:"3147270890545",propertyInfo:"颜色分类:紫色;拖把头个数:3个;类型:金属篮;拖把杆类型:加强杆+不锈钢盘"}];